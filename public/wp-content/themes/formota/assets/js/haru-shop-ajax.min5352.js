var HARUSHOP=HARUSHOP||{};!function(e){"use strict";HARUSHOP={init:function(){HARUSHOP.$html=e("html"),HARUSHOP.$window=e(window),HARUSHOP.$shopFilterMenu=e("#haru-shop-filter-menu"),HARUSHOP.$searchPanel=e("#haru-shop-search"),HARUSHOP.$shopWrap=e(".haru-archive-product"),HARUSHOP.$shopBrowseWrap=e(".archive-product-wrapper"),HARUSHOP.$searchBtn=e("#haru-shop-search-btn"),HARUSHOP.$searchNotice=e("#haru-shop-search-notice"),HARUSHOP.filterPanelSliding=!1,HARUSHOP.filterPanelSlideSpeed=300,HARUSHOP.shopLoaderSpeed=300,HARUSHOP.shopFilterMenuFnNames={cat:"shopFiltersCategoriesToggle",filter:"shopFiltersSidebarToggle",search:"shopFiltersSearchToggle"},HARUSHOP.$window.on("popstate.harushop",function(e){e.originalEvent.state&&e.originalEvent.state.haruShop&&HARUSHOP.shopGetPage(window.location.href,!0)}),HARUSHOP.$html.hasClass("history")?(HARUSHOP.hasPushState=!0,window.history.replaceState({haruShop:!0},"",window.location.href)):HARUSHOP.hasPushState=!1,HARUSHOP.shopFiltersBind(),HARUSHOP.shopSearchBind(),HARUSHOP.shopLoadmoreBind()},shopFiltersBind:function(){HARUSHOP.$shopFilterMenu.find("a").on("click",function(a){if(a.preventDefault(),!HARUSHOP.filterPanelSliding){HARUSHOP.filterPanelSliding=!0;var r=0,o=e(this).parent("li"),s=o.data("panel");o.hasClass("active")||(r=HARUSHOP.shopFiltersHideActivePanel()),o.toggleClass("active"),setTimeout(function(){var e=HARUSHOP.shopFilterMenuFnNames[s];HARUSHOP[e]()},r)}}),HARUSHOP.$shopWrap.on("click","#haru-shop-categories a",function(a){a.preventDefault();var r=e(this),o=r.parent("li");HARUSHOP.$searchBtn.parent("li").hasClass("active")&&HARUSHOP.$searchBtn.trigger("click"),e("#haru-shop-categories").children(".current-cat").removeClass("current-cat"),o.addClass("current-cat"),HARUSHOP.shopGetPage(r.attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .haru_widget a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_product_categories a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_layered_nav a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_layered_nav_filters a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_product_tag_cloud a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"),!1,!0)}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget_rating_filter a",function(a){a.preventDefault(),HARUSHOP.shopGetPage(e(this).attr("href"))}),HARUSHOP.$shopWrap.on("click","#haru-shop-filters-reset",function(e){e.preventDefault();var a=location.href.replace(location.search,"");HARUSHOP.shopGetPage(a)}),HARUSHOP.$shopWrap.on("click","#haru-shop-search-taxonomy-reset",function(a){a.preventDefault();var r=e(this);if(r.closest(".haru-shop-results-bar").hasClass("is-search")){var o=HARUSHOP.urlGetParameter("s")?r.data("shop-url"):location.href.replace(location.search,"");HARUSHOP.$searchBtn.trigger("click")}else o=r.data("shop-url");HARUSHOP.shopGetPage(o)}),HARUSHOP.$shopWrap.on("click","#haru-shop-sidebar .widget-title",function(a){e(this).toggleClass("active"),e(this).parent().find("div, ul").toggleClass("show")})},shopFiltersHideActivePanel:function(){var e=0,a=HARUSHOP.$shopFilterMenu.children(".active");if(a.length){a.removeClass("active");var r=a.data("panel");if(a.is(":hidden")&&"cat"==r)HARUSHOP.shopFiltersCategoriesReset();else{e=300;var o=HARUSHOP.shopFilterMenuFnNames[r];HARUSHOP[o]()}}return e},shopFiltersCategoriesToggle:function(){e("#haru-shop-categories").slideToggle(HARUSHOP.filterPanelSlideSpeed,function(){var a=e(this);a.toggleClass("fade-in"),a.hasClass("fade-in")||a.removeClass("force-show").css("display",""),HARUSHOP.filterPanelSliding=!1})},shopFiltersCategoriesReset:function(){e("#haru-shop-categories").removeClass("fade-in force-show").css("display","")},shopFiltersSidebarToggle:function(){var a=e("#haru-shop-sidebar"),r=a.is(":visible");r&&a.removeClass("fade-in"),a.slideToggle(HARUSHOP.filterPanelSlideSpeed,function(){r||a.addClass("fade-in"),HARUSHOP.filterPanelSliding=!1})},shopFiltersSearchToggle:function(){HARUSHOP.searchPanelToggle(),HARUSHOP.currentSearch=""},searchPanelToggle:function(){var a=e("#haru-shop-search-input");HARUSHOP.$searchPanel.slideToggle(200,function(){HARUSHOP.$searchPanel.toggleClass("fade-in"),HARUSHOP.$searchPanel.hasClass("fade-in")?a.focus():a.val(""),HARUSHOP.filterPanelSliding=!1}),HARUSHOP.shopSearchHideNotice()},shopSearchHideNotice:function(a){e("#haru-shop-search-notice").removeClass("show")},shopGetPage:function(a,r,o){if(HARUSHOP.shopAjax)return!1;a&&(HARUSHOP.shopShowLoader(),a=a.replace(/\/?(\?|#|$)/,"/$1"),r||HARUSHOP.setPushState(a),HARUSHOP.shopAjax=e.ajax({url:a,data:{shop_load:"full"},dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"POST",error:function(e,a,r){console.log("Haru: AJAX error - shopGetPage() - "+r),HARUSHOP.shopHideLoader(),HARUSHOP.shopAjax=!1},success:function(e){HARUSHOP.shopUpdateContent(e),HARUSHOP.shopLoadmoreBind(),HARUSHOP.shopAjax=!1}}))},setPushState:function(e){window.history.pushState({haruShop:!0},"",e)},shopUpdateContent:function(a){var r=e("<div>"+a+"</div>"),o=r.find("#haru-shop-categories"),s=r.find("#haru-shop-widgets-ul"),t=r.find(".archive-product-wrapper");if(o.length){var h=e("#haru-shop-categories");h.hasClass("fade-in")&&o.addClass("fade-in force-show"),h.replaceWith(o)}s.length&&e("#haru-shop-widgets-ul").replaceWith(s);t.length&&HARUSHOP.$shopBrowseWrap.replaceWith(t),HARUSHOP.$shopBrowseWrap=e(".archive-product-wrapper"),HARUSHOP.$shopBrowseWrap.find("ul.products").addClass("grid"),HARUSHOPMAIN.woocommerce.init()},shopShowLoader:function(a){e("#haru-shop-products-overlay").addClass("show")},shopHideLoader:function(a){var r=e("#haru-shop-products-overlay");r.removeClass("haru-loader").addClass("fade-out"),setTimeout(function(){r.removeClass("show fade-out").addClass("haru-loader")},HARUSHOP.shopLoaderSpeed)},shopSearchBind:function(){var a,r;HARUSHOP.$searchInput=e("#haru-shop-search-input"),HARUSHOP.searchAjax=null,HARUSHOP.currentSearch="",e("#haru-shop-search-close").on("click",function(e){e.preventDefault(),HARUSHOP.$searchBtn.trigger("click")}),e("#haru-shop-search-input").on("input",function(){var e=HARUSHOP.$searchInput.val();e=e.trim(),e.length?HARUSHOP.$searchNotice.addClass("show"):HARUSHOP.$searchNotice.removeClass("show")}).trigger("input"),HARUSHOP.$searchInput.keypress(function(o){if(a=e(this),r=a.val(),"13"==(o.keyCode?o.keyCode:o.which)){o.preventDefault();var s=HARUSHOP.$searchInput.val();(s=s.trim()).length&&HARUSHOP.currentSearch!==r?setTimeout(function(){HARUSHOP.shopSearch(r)},HARUSHOP.filterPanelSlideSpeed):HARUSHOP.currentSearch=r}})},shopSearch:function(a){HARUSHOP.shopShowLoader(),HARUSHOP.currentSearch=a,HARUSHOP.searchAjax=e.ajax({url:searchUrl+encodeURIComponent(a),data:{shop_load:"search",post_type:"product"},dataType:"html",method:"GET",error:function(e,a,r){console.log("Haru: AJAX error - shopSearch() - "+r),HARUSHOP.shopHideLoader(),HARUSHOP.searchAjax=null},success:function(e){HARUSHOP.shopUpdateContent(e),HARUSHOP.shopLoadmoreBind(),HARUSHOP.searchAjax=null}})},urlGetParameter:function(e){var a,r,o=decodeURIComponent(window.location.search.substring(1)).split("&");for(r=0;r<o.length;r++)if((a=o[r].split("="))[0]===e)return void 0===a[1]||a[1]},updateUrlParameter:function(e,a,r){var o=e.indexOf("#"),s=-1===o?"":e.substr(o);e=-1===o?e:e.substr(0,o);var t=new RegExp("([?&])"+a+"=.*?(&|$)","i"),h=-1!==e.indexOf("?")?"&":"?";return(e=e.match(t)?e.replace(t,"$1"+a+"="+r+"$2"):e+h+a+"="+r)+s},shopLoadmoreBind:function(){HARUSHOP.$shopBrowseWrap.on("click",".haru-loadmore-btn",function(e){e.preventDefault(),HARUSHOP.shopLoadmoreGetPage()})},shopLoadmoreGetPage:function(){if(HARUSHOP.shopAjax)return!1;var a=HARUSHOP.$shopBrowseWrap.find(".haru-loadmore-link").find("a"),r=HARUSHOP.$shopBrowseWrap.find(".haru-loadmore-controls"),o=a.attr("href");o?(o=HARUSHOP.updateUrlParameter(o,"shop_load","products"),r.addClass("haru-loader"),HARUSHOP.shopAjax=e.ajax({url:o,dataType:"html",cache:!1,headers:{"cache-control":"no-cache"},method:"GET",error:function(e,a,r){console.log("Haru: AJAX error - shopLoadmoreGetPage() - "+r)},complete:function(){r.removeClass("haru-loader")},success:function(s){var t=e("<div>"+s+"</div>"),h=t.find("ul.products").children("li.product").css({opacity:0});HARUSHOP.$shopBrowseWrap.find("ul.products").append(h),h.imagesLoaded(function(){h.animate({opacity:1}),e("ul.products").isotope("appended",h),setTimeout(function(){e("ul.products").isotope("layout")},400),HARUSHOPMAIN.woocommerce.init()}),(o=t.find(".haru-loadmore-link").children("a").attr("href"))?a.attr("href",o):(r.addClass("hide-btn"),e(".haru-loadmore-all").addClass("show"),a.removeAttr("href")),HARUSHOP.shopAjax=!1}})):(r.addClass("hide-btn"),e(".haru-loadmore-all").addClass("show"))}},e(document).ready(HARUSHOP.init)}(jQuery);